# 匿名树洞学习项目总结

## 1. 项目定位

这是一个前后端分离的匿名树洞学习项目：

- 前端：原生 HTML + CSS + JavaScript
- 后端：Node.js + Express
- 存储：本地 JSON 文件（`posts.json` / `likes.json`）

目标是通过一个小体量项目学习完整的 Web 功能闭环，而不是生产级落地。

## 2. 当前已实现功能

- 匿名发帖
- 按最新/最热排序
- 点赞 / 取消点赞（已拆分为独立操作）
- 点赞状态回显（`likedByMe`）
- 本人/陌生人身份标记（`isMine`）
- 点赞按钮状态变化（已点赞高亮）
- 相对时间显示（秒/分钟/小时/天）
- 敏感词脱敏
- 发帖和点赞限流
- CORS 本地开发友好策略
- 历史数据兼容（旧数字 ID 与旧点赞 key）

## 3. 核心接口设计

- `POST /api/posts`
  - 创建帖子
  - 请求体：`{ text: string }`
- `GET /api/posts?sort=time|hot`
  - 获取帖子列表
  - 返回字段含：`likedByMe`、`isMine`
- `POST /api/posts/:id/like`
  - 点赞
- `DELETE /api/posts/:id/like`
  - 取消点赞

点赞改为显式的 POST/DELETE 语义，有助于前端状态管理和接口可读性。

## 4. 本次关键优化点（按优先级执行）

### 4.1 安全与稳定

- 修复前端 `innerHTML` 注入风险（改为 DOM 安全渲染）
- 引入写队列 + 原子写，降低 JSON 存储并发覆盖风险
- 帖子 ID 从时间戳改为 UUID
- CORS 从全开放改为可控策略

### 4.2 交互与体验

- 点赞/取消点赞按钮拆分
- 点赞数独立展示
- 点赞后按钮高亮
- 按钮请求中 loading 态，防止误连点
- 空列表提示
- 页面响应式增强（移动端/桌面端布局自适应）

### 4.3 主题化能力

- 匿名身份显示：本人 / 陌生人
- 敏感词脱敏，降低极端内容直出风险
- 限流策略，控制刷帖刷赞行为

## 5. 你在这个项目里学到的重点

- 如何在小项目中做前后端契约设计（字段新增与兼容）
- 如何做历史数据兼容而不重置现有数据
- 如何把“功能完成”提升到“可维护可扩展”
- 如何通过最小改动落地基础安全能力（XSS/CORS/限流）
- 如何从交互层改进用户感知（状态、反馈、响应式）

## 6. 当前边界（为什么它仍是学习项目）

- 存储层仍是 JSON 文件，不适合多实例和高并发
- 没有审核后台与举报闭环
- 没有监控告警、备份恢复与部署流水线

这些能力更适合放到下一阶段（如 SQLite + 管理后台）继续学习。

## 7. 下一步学习建议（可选）

1. 把存储从 JSON 迁移到 SQLite（最低成本提升可靠性）
2. 新增举报与简单审核页面（补齐匿名社区治理闭环）
3. 补一套接口文档（OpenAPI）和更系统的自动化测试
4. 引入 TypeScript，提升重构安全性

## 8. 项目主要文件

- 前端页面：`index.html`
- 前端逻辑：`app.js`
- 后端服务：`backend/server.js`
- 测试：`tests/api.test.js`
- 运行说明：`README.md`

